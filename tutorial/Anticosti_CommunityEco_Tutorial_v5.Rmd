---
title: "After the storm: Impacts of a hemlock looper (*Lambdina fiscellaria*) outbreak on tree species in Anticosti Island, 1973"
author: |
  | Living Data Project  
  | Victoria Marie Glynn (McGill)
  | Maxime Fraser Franco (UQAM)
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: learnr::tutorial
runtime: shiny_prerendered
---

```{r, setup, include = FALSE}
library(learnr)
library(rsconnect)
knitr::opts_chunk$set(echo = TRUE)
```

## Context

When you think of predator-prey interactions, what comes to mind? Perhaps it is the emblematic hare and lynx example from the [Hudson's Bay Company pelt-trading dataset](https://jckantor.github.io/CBE30338/02.05-Hare-and-Lynx-Population-Dynamics.html), or footage from nature documentaries that show lions hunting zebras. But predator-prey interactions are often less conspicuous, and still strongly impact ecological communities. A great example are insect pests and their plant prey. In this tutorial, we are going to explore an instance of this interaction on Anticosti Island, Québec, between the hemlooper looper (*Lambdina fiscellaria*) and the trees it predates upon. 

<br>

![Map of Anticosti Island, Québec](images/anticosti_loc.png) ![Picture of the hemlock looper](images/hemlock_looper_larva.jpg)

<br>

### What happened?

The hemlock looper is a moth pest that is found [all across Canada](http://www.glfc.forestry.ca/VLF/ForumPresentations/heberthemlocklooper_08e.pdf), and into the USA, as far south as the state of Georgia. Since 1910, it has wrecked havok in  Québec's forests. Between 1910 and 1975, these outbreaks caused an estimated [24 million cubic meters of forest to be lost](https://fr.wikipedia.org/wiki/Lambdina_fiscellaria) in the province. Since then, additional outbreaks have occurred across Québec in places like Bas-Saint-Laurent , Gaspésie , and Anticosti Island. 

Since the first outbreak, the Ministry of Forests, Wildlife and Parks of Quebec (MFFP) and the Society for the Protection of Forests against Insects and Diseases (SOPFIM) have been monitoring hemlock looper outbreaks. The MFFP recorded and surveyed one of the most extensive tree mortality events due to a hemlock looper outbreaks from the [period of 1971-1973](https://cfs.nrcan.gc.ca/pubwarehouse/pdfs/6856.pdf). As the hemlock looper larvae usually attacks mature tree stands by eating the leaves, causing them to appear [yellow and red-brown in color](https://tidcf.nrcan.gc.ca/en/insects/factsheet/8846). 

<br>

![](images/balsam_looper.jpg)
<br>
Severely defoliated balsam fir forest in July, photograph by Dr. Luc Jobin

<br>

While the outbreak was occuring, in 1973 Dr. Luc Jobin (Laurentian Forestry Centres), Michel Chabot (student at that moment, now a forester er in MFFP) went to Anticosti island to visually survey the degree of damage that the hemlock looper was causing. In their data, openly hosted on the [Government of Canada webpage](https://open.canada.ca/data/en/dataset/9dda09b0-649f-4002-b207-7b204eb81cbb), they denoted a tree as either being "good," meaning it did not show any damage from the outbreak, "dead" if the hemlock looper had attacked and killed the stand, and "questionable" if they were unsure. This historical, and yet still very relevant dataset, allows us to think further about how an outbreak occurs and the impact it has in ecological communities. 

## Learning objectives 

### Given the hemlock looper was such an aggressive pest, our objectives are to determine:

#### **1. What is the tree community composition of Anticosti Island?**
#### **2. Does the hemlock looper preferentially attack some trees or instead multiple trees?**
#### **3. Does the hemlock looper attack specific trees because they are more abundant?**

<br>
<br>

Based on what you find, we will ask you to provide some management strategies, as the hemlock looper is still an issue in Québec's forests.

---

## Setting up our R session

Let's start by loading some packages we will use for our analyses
```{r, message = FALSE, warning = FALSE}
library(data.table)
library(ggplot2)
library(dplyr)
```

Then, we import the data in the current R session
```{r, message = FALSE, warning = FALSE}
# Tree condition data url paths
url_tree <- "https://open.canada.ca/data/en/dataset/9dda09b0-649f-4002-b207-7b204eb81cbb/resource/a1606235-95aa-4c81-a8db-19b852be288c"
csv_tree <- "download/anticosti_1973_trees.csv"

# Import the data and keep the data we need
tree <- fread(file.path(url_tree, csv_tree),
              select = c("Block", "Compartment", "Plot",
                         "Cell", "Species", "Species_abbrev",
                         "Condition", "Number"))

# Separate row number in instances to have all individual counts
tree <- tree[rep(seq(.N), Number)]
tree[, Number := 1]

# Change "Larch" to "American larch"
# Change "Pine" to "Pine sp."
# Change "Aspen" to "Aspen sp."
tree$Species <- gsub("Larch", "American larch", tree$Species)
tree$Species <- gsub("Pine", "Pine sp.", tree$Species)
tree$Species <- gsub("Aspen", "Aspen sp.", tree$Species)

```

## Learning objective 1

### Describing Anticosti Island's tree community composition

#### We will first investigate the tree species that were identified during the outbreak. To do so, we are going to plot the tree species using a boxplot. This will enable us to evaluate their distribution across the sampled sites on Anticosti Island.

We will first make some preparations for our boxplot to look nice:
```{r, warnings = FALSE}
# First, we arrange a table to plot our tree species abundances
tree[, species_richness := length(Species),
     by = .(Cell, Plot, Compartment, Block)]

boxplot_tab <- unique(tree[,.(Species, species_richness)])


# We then prepare a custom theme to have a nice plot
custom_theme <- theme(# axis values size
                      axis.text.x = element_text(face = "plain", 
                                                 size = 12,
                                                 color = "black"),
                      axis.text.y = element_text(face = "plain", 
                                                 size = 12,
                                                 color = "black"),
                      # axis ticks lenght
                      axis.ticks.length = unit(.15, "cm"),
                      # axis ticks width
                      axis.ticks = element_line(size = 0.90, 
                                                color = "black"),
                      # axis titles size
                      axis.title = element_text(size = 15, 
                                                face = "plain"),
                      plot.title = element_text(size = 17, 
                                           face = "plain"),
                      axis.line = element_line(size = 0.95),
                      #legend.position = "none",
                      panel.grid = element_blank(),
                      panel.background = element_blank())
```

Now we can visualize our boxplot:
```{r, warnings = FALSE, message = FALSE, fig.width = 8, fig.height = 8}
ggplot(boxplot_tab,
       aes(x = Species,
           y = species_richness)) +
  geom_boxplot(fill = "light green",
               color = "black") +
  geom_dotplot(binaxis = "y",
               stackdir = "center",
               dotsize = 0.4) +
  geom_jitter(shape = 16,
              position = position_jitter(0.2)) +
  xlab("Tree specie\n") +
  ylab("\nNumber of individuals") +
  scale_y_continuous(breaks = seq(0, 30, 5)) +
  custom_theme +
  coord_flip()
```

#### From this boxplot, we see that seven different tree species were identified, with their respective abbreviation from the dataset shown in parentheses:

#### 1. White birch (BOP) - *Betula papyrifera*
#### 2. White spruce (EPB) - *Picea glauca*
#### 3. Black spruce (EPN) - *Picea mariana*
#### 4. American larch (Meleze) - *Larix laricina*
#### 5. Aspen (Peuplier) - *Populus* spp.
#### 6. Pine (Pin) - *Pinus* spp.
#### 7. Balsam fir (SAB) - *Abies balsamea*

![](images/Tree_Anticosti.png){width=90%}
<br>
Tree species that were sampled on Anticosti Island

<br>

### Let's test our knowledge!

#### From looking at the boxplot: 

```{r checkbox-a, echo = FALSE}
question("What tree species is the most abundant in the data? Select all that apply",
  answer("White birch (BOP) - *Betula papyrifera*"),
  answer("White spruce (EPB) - *Picea glauca*"),
  answer("Black spruce (EPN) - *Picea mariana*"),
  answer("American Larch (Meleze) - *Larix laricina*"),
  answer("Aspen (Peuplier) - *Populus* spp."),
  answer("Pine (Pin) - *Pinus* spp."),
  answer("Balsam fir (SAB) - *Abies balsamea*", correct = TRUE)
)
```

```{r checkbox-b, echo = FALSE}
question("What tree species is the least abundant in the data? Select all that apply.",
  answer("White birch (BOP) - *Betula papyrifera*"),
  answer("White spruce (EPB) - *Picea glauca*"),
  answer("Black spruce (EPN) - *Picea mariana*"),
  answer("American Larch (Meleze) - *Larix laricina*", correct = TRUE),
  answer("Aspen (Peuplier) - *Populus* spp.", correct = TRUE),
  answer("Pine (Pin) - *Pinus* spp.", correct = TRUE),
  answer("Balsam fir (SAB) - *Abies balsamea*")
)
```

## Learning objective 2

### How were the different tree species impacted by the hemlock looper?

#### Here, the scientists who sampled the individual trees assigned a damage state to each one of them. They assigned one of the three following states : "Dead", "Good", or "Questionable".

To investigate the differences in damage among the tree species, we will first need to calculate the proportion of observed damage states per tree species:
```{r, message = FALSE, warning = FALSE}
tree_damage <- tree %>%
  group_by(Species, Condition) %>%
  summarise(n = n()) %>%
  mutate(freq = n / sum(n))
```

We can then plot this with the following commands:
```{r, message = FALSE, warning = FALSE, fig.width = 9, fig.height = 6}
ggplot(tree_damage,
       aes(y = freq,
           x = Species,
           fill = Condition)) + 
  geom_bar(position = "stack",
           stat = "identity",
           color = "black") +
  scale_fill_manual(values = c("light green", "plum", "khaki1")) +
  ggtitle("Relative damage for each tree species") +
  xlab("Tree specie\n") +
  ylab ("\nProportion of damage") +
  custom_theme +
  coord_flip()
```

### Let's test our knowledge!

#### From looking at this plot:

```{r checkbox-c, echo = FALSE}
question("What tree species was **MOST** affected by the hemlock looper? Select all that apply.",
  answer("White birch (BOP) - *Betula papyrifera*"),
  answer("White spruce (EPB) - *Picea glauca*"),
  answer("Black spruce (EPN) - *Picea mariana*"),
  answer("Larch (Meleze) - *Larix* spp."),
  answer("Aspen (Peuplier) - *Populus* spp."),
  answer("Pine (Pin) - *Pinus* spp."),
  answer("Balsam fir (SAB) - *Abies balsamea*", correct = TRUE)
)
```

```{r checkbox-d, echo = FALSE}
question("What tree species was **LEAST** affected by the hemlock looper? Select all that apply.",
  answer("White birch (BOP) - *Betula papyrifera*"),
  answer("White spruce (EPB) - *Picea glauca*"),
  answer("Black spruce (EPN) - *Picea mariana*"),
  answer("Larch (Meleze) - *Larix* spp.", correct = TRUE),
  answer("Aspen (Peuplier) - *Populus* spp.", correct = TRUE),
  answer("Pine (Pin) - *Pinus* spp.", correct = TRUE),
  answer("Balsam fir (SAB) - *Abies balsamea*")
)
```

These two previous plots beg the following question: were hemlock loopers attacking Balsam firs (SAB) because they are more abundant, or because this is their preferred prey? In other words, is this a **generalist** or **specialist** pest? What does this mean?

- A species is a **generalist** if it can live in a variety of environments and eat a variety of foods, meaning it is quite flexible in its diet and habitat requirements. 
- A species is a **specialist** if it has a limited diet, and stricter habitat requirements, meaning it cannot live anywhere and cannot eat anything. 

Two great examples are pigeons and koalas -- pigeons live in a diversity of urban environments and are omnivores (eat plant and animal matter), while koalas only live on and eat eucalyptus. 

![](images/specialist_generalists.png)
Example of specialist and generalist species

With this in mind, let us run one more plot to gain some further insights:

## Learning objective 3

### Is there a relationship between the abundance of trees and the trees that the hemlock looper attacks?

This question asks us to consider any density-dependent relationships. We thus need to consider the **relative proportion** of a given tree species, as it relates to the relative proportion of trees that were denoted as "dead." (WE NEED TO THINK ABOUT HOW WE BRING THIS CUZ IM UNSURE FOR NOW).

With this in mind, please answer the following question to help us draw predictions for our plot:
```{r letter-e, echo = FALSE}

question("What would you expect to see if a tree was most damaged by hemlock looper because it was more abundant?",
         answer("An increasing, straight line - one-to-one relationship, where having more trees means more damage will be detected*", correct = TRUE),
         answer("A decreasing, straight line - one-to-one relationship, where having less trees means more damage will be detected"),
         answer("A ... - what drives dynamics is tree species identity, and not that species' abundance")
 
)
```

Maxime's plots

### Let's test our knowledge!

**From the graph and  based on our predictions above, we can now answer the question:**
```{r letterx-d, echo=FALSE}
question("Do hemlock loopers preferentially attack a given tree species?",
  answer("Yes, because", correct = TRUE),
  answer("Yes, "),
  answer("No, because"),
  answer("No, because b")
)
```

## Interpretations and implications

### What do our findings imply in terms of pest management on Anticosti Island? 

This dataset represents one of the many hemlock looper outbreaks Anticosti island, and Québec as a whole, has experienced. Based on your findings, for homework before our next lecture please reflect on the following questions. To help inform your answers, please refer to the following helpful links about hemlock looper:

- [Hemlock looper overview](https://www.plantwise.org/knowledgebank/datasheet/29749)
- [Biological control of the hemlock looper](https://www.plantwise.org/KnowledgeBank/pestalert?pan=19740515762)
- [Hemlock looper life history, management considerations](https://www.fs.usda.gov/Internet/FSE_DOCUMENTS/stelprdb5191788.pdf)

### Take-home questions

#### What trees would you most closely monitor?
#### What additional protections/restrictions should exist on Anticosti island?
#### What management suggestions would you provide to the MFPP?
