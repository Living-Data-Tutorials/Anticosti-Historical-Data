---
title: "Community Ecology: Hemlock Looper Outbreak on Anticosti Island"
author:
  - name: Victoria Marie Glynn
    affiliation: McGill University
    email: victoria.glynn@mail.mcgill.ca
  - name: Maxime Fraser Franco
    affiliation: Université du Québec à Montréal (UQAM) 
    email: fraser_franco.maxime@courrier.uqam.ca
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  learnr::tutorial:
    progressive: true
    allow_skip: true
    theme: "sandstone"
    #toc_float:
    #  collapsed: true
    highlight: "pygments"
runtime: shiny_prerendered
---

<style type="text/css">
  body{
  font-size: 13pt;
}
  p.caption {
    font-size: 0.8em;
}
</style>

```{r setup, include = FALSE}
library(learnr)
library(rsconnect)
library(shiny)
library(shinyFeedback)
knitr::opts_chunk$set(echo = TRUE,
                      message = FALSE,
                      warning = FALSE)
```

---------------------------------------------------------------------------------------

## Welcome to the Living Data Tutorials   {data-progressive=FALSE}

### The project

The Living Data Tutorials (LDTs) were developed by graduate students in ecology and evolution during the spring of 2022 as part of the Canadian Institute of Ecology and Evolution's ([CIEE](https://www.ciee-icee.ca/data.html)) Living Data Project (LDP). Our goal is to provide free and open-access teaching material in the form of online tutorials to undergraduate students in ecology and evolution.

All the tutorials make use of publicly available Canadian datasets to address specific topics in ecology and evolution. The following tutorial was built with the free and open-source [R](https://www.r-project.org/) programming language using the [leanr package](https://rstudio.github.io/learnr/). You can find the project folders and files in this [GitHub repository](https://github.com/Living-Data-Tutorials/Anticosti-Historical-Data).

We would like to thank [Anne Cotton-Gagnon](https://scf.rncan.gc.ca/employes/vue/acottong), MSc, and [Christian Hébert](https://cfs.nrcan.gc.ca/employees/read/chhebert), PhD, from Natural Resources Canada and the Laurentian Forestry Centre for their insights on the original datasets and access to the reports and maps associated with such.

### Developers

The present tutorial was developed by Victoria Marie Glynn who is a PhD student at McGill University in Montréal, Québec, and Maxime Fraser Franco who is a PhD student at the Université du Québec à Montréal (UQAM) in Montréal, Québec.

Please feel free to contact us if you have any question :

Victoria Marie Glynn - victoria.glynn@mail.mcgill.ca

Maxime Fraser Franco - fraser_franco.maxime@courrier.uqam.ca

<br>

```{r, echo = FALSE, out.width = "50%", fig.align = "left"}
knitr::include_graphics("images/ciee.jpeg")
```

---------------------------------------------------------------------------------------

## Tutorial objectives

By the end of this tutorial, you will be able to : 

 - Interpret community ecology plots.
 - Differentiate between a generalist and specialist pest species, using community ecology plots.
 - Make data-driven management recommendations.

<br>

The Anticosti Island tree dataset provides a unique opportunity for us to use **real and historical data** to gain skills in understanding what commonly made research plots, such as stacked bar plots, mean and how these figures can help us think more critically about natural resource management in Canada.

---------------------------------------------------------------------------------------

## What we will explore

When you think of consumer-resource interactions, what comes to mind? Perhaps it is the emblematic hare and lynx example from the [Hudson's Bay Company pelt-trading dataset](https://jckantor.github.io/CBE30338/02.05-Hare-and-Lynx-Population-Dynamics.html), or footage from nature documentaries that showcase lions hunting zebras. But consumer-resource interactions are often less conspicuous, and yet still strongly impact ecological communities. A great example are animals that consume plants as their main source of food (i.e. plant-herbivore interactions), such as insect pests and their plant prey. Insect pests are an important source of economic losses in the agricultural and forest industries. It is thus crucial that we understand the ecology of these insects if we want to minimize their damages and predict when and where they will strike.

###

### Getting acquainted with our study system

In this tutorial, we are going to explore an instance of a plant-herbivore interaction -- an insect and its tree hosts. We will investigate a hemlock looper (*Lambdina fiscellaria*) outbreak in Québec's Anticosti Island in 1973. The hemlock looper is a moth pest that is found [all across Canada](http://www.glfc.forestry.ca/VLF/ForumPresentations/heberthemlocklooper_08e.pdf), and parts of the USA, often as far south as the state of Georgia.

###

### Meeting the hemlock looper

The hemlock looper is a voracious coniferous and deciduous plant pest. Native to North America and found in Eastern Canada and the United States, part of its destruction is linked to its [life cycle](https://www.maine.gov/dacf/mfs/forest_health/insects/hemlock_looper.htm). The moth lays its eggs on tree leaves, and upon hatching in June, the larvae proceed to eat these. As the larvae develop, they move from eating young to more mature leaves. The larvae is often described as a "messy eater," as it goes nipping from leaf to leaf. These chewed leaves then die and drop below to the forest floor. 

<br>
<br>

```{r, echo = FALSE, out.width = "50%", fig.align = "center", fig.cap = "Anticosti Island, Québec, shown as a blue pin on a map of Eastern Canada and Northeastern United States of America."}

library(leaflet)
pacman::p_load(leaflet)
leaflet() %>%
  addTiles() %>%  # Add default OpenStreetMap map tiles
  addMarkers(lng= -63, lat= 49.5) %>%
  setView(-62, 48, zoom = 5)

```
<br>

After chewing away at a trees' leaves, the looper larvae retreat into the cracks of the tree to become pupae. In early-August, after 2-3 weeks of being a pupae, the larvae flutter away as adult hemlock looper moths. 

<br>

```{r, echo = FALSE, out.width = "70%", fig.align = "center", fig.cap = "Comic illustrating the hemlock looper lifecycle, by Victoria Marie Glynn. The hemlock looper lays its eggs on coniferous and deciduous tree leaves (left panel). When the eggs hatch, the larvae proceed to eat leaves throughout the tree (middle panel). The chewed leaves eventually fall to the floor and die, killing the tree if the damage is sufficient (right panel)."}
knitr::include_graphics("images/hemlock_eating_comic.png")
```

<br> 
<br> 

```{r, echo = FALSE, out.width = "50%", fig.align = "center", fig.cap = "Hemlock looper larvae. Photography credits: Maine Forest Service, Forest Health & Monitoring, Slide Collection."}
knitr::include_graphics("images/hemlock_looper_larva.jpg")
```

<br>

<style>
.html-widget {
    margin: auto;
}
</style>


<br>


### What happened on Anticosti Island in 1973?

Since 1910, the hemlock looper has wreaked havoc in Québec's forests. Between 1910 and 1975, these outbreaks caused an estimated [24 million cubic meters of forest to be lost](https://archive.wikiwix.com/cache/index2.php?url=http%3A%2F%2Fwww.sopfim.qc.ca%2Ffr%2Finsectes%2Finsectes_arpenteuse.html#federation=archive.wikiwix.com&tab=url) in the province. Since then, additional outbreaks have occurred across Québec in places like Bas-Saint-Laurent, Gaspésie, and Anticosti Island. 

Since the first outbreak, the Ministry of Forests, Wildlife and Parks of Québec ([MFFP](https://mffp.gouv.qc.ca/?lang=en)) and the Society for the Protection of Forests against Insects and Diseases ([SOPFIM](https://sopfim.qc.ca/fr/)) have been monitoring hemlock looper outbreaks. The MFFP surveyed one of the most extensive tree mortality events due to a hemlock looper outbreak from [1971-1973](https://cfs.nrcan.gc.ca/pubwarehouse/pdfs/6856.pdf). As the hemlock looper larvae usually attack mature tree stands by eating their leaves, it causes them to appear [yellow and red-brown in color](https://tidcf.nrcan.gc.ca/en/insects/factsheet/8846), a tell-tale sign that an outbreak has occurred. Researchers often use this visual cue to assess degree of damage. 

<br>

```{r, echo = FALSE, out.width = "50%", fig.align = "center", fig.cap = "Severely defoliated balsam fir (*Abies balsamea*) forest due to a hemlock looper outbreak, photograph by Dr. Luc Jobin."}
knitr::include_graphics("images/balsam_looper.jpg")
```

<br>

While the outbreak was occuring, in 1973 Dr. Luc Jobin from the [Laurentian Forestry Centre](https://www.nrcan.gc.ca/science-and-data/research-centres-and-labs/forestry-research-centres/laurentian-forestry-centre/13473), and his student Michel Chabot (then going onto becoming a forester in MFFP) went to Anticosti Island to visually survey the degree of damage that the hemlock looper was causing. In their data, openly hosted on the [Government of Canada's website](https://open.canada.ca/data/en/dataset/9dda09b0-649f-4002-b207-7b204eb81cbb), they denoted a tree as either being "Good," meaning it did not show any signs of damage from the outbreak, "Dead" if the hemlock looper had attacked and killed the stand, or "Questionable" if they were unsure. This historical, and yet still very relevant dataset, allows us to think about the impact pest outbreaks have on ecological communities.

<br>

```{r, echo = FALSE, out.width = "70%", fig.align = "center", fig.cap = "Map of Anticosti Island in 1973, during the hemlock looper outbreak, courtesy of Anne Cotton-Gagnon, MSc, Natural Resources Canada (Laurentian Forestry Centre). The colors on the map represent the surveyed regions, with purple indicating severe defoliation, yellow indicating medium defoliation, and green indicating light defoliation. The red lines indicate the start of the one mile transect surveyed."}
knitr::include_graphics("images/Carte_generale1.jpg")
```

---------------------------------------------------------------------------------------

## Tutorial sections 

With our Anticosti Island tree dataset, this tutorial will walk us through **four sections** in order for us to understand the impacts of the hemlock looper on Anticosti's forests.

<br> 

Following the 1973's hemlock looper outbreak on Anticosti Island, we will: 

1. Describe the island's tree community composition

2. Estimate the damage on the tree community

3. Evaluate if the hemlock looper preferentially attacks certain tree species

4. Based on 1-3, make management recommendations for coping with future outbreaks

<br> 

At the end of each section, we will have a "Let us test our knowledge!" section before moving forward, as each section builds upon the next.

But before jumping into our tutorial, it is important we **set up our coding session and explore our data**. This is an important but often overlooked aspect of research -- how and what data is gathered often drives the inferences we can make. 

---------------------------------------------------------------------------------------

## Setting up our coding session

Any R coding session requires that the user define the packages required for data manipulation and analysis. Of course, before we can analyze any data, we also need to import it! This is what we are going to do in this section of the tutorial.

<br>

Let us start by loading the packages we will need for our analyses:
```{r}
# To perform data manipulations
library(data.table)
library(dplyr)

# To produce nice plots
library(ggplot2)
```

Then, we import the data in the current R session. To do so, we will directly access the data from the web server where it is hosted. This is a nice way of importing data because it does not require that we download it to our computer.
```{r}
# Tree condition data URL paths
url_data_portal <- "https://open.canada.ca/data/en/dataset"
url_anticosti <- "9dda09b0-649f-4002-b207-7b204eb81cbb/resource/a1606235-95aa-4c81-a8db-19b852be288c"
csv_tree <- "download/anticosti_1973_trees.csv"

# Import the data and keep the columns we need
tree <- fread(file.path(url_data_portal, url_anticosti, csv_tree),
              select = c("Block", "Compartment", "Plot",
                         "Cell", "Species", "Species_abbrev",
                         "Condition", "Number"))

```

---------------------------------------------------------------------------------------

## Data exploration

Exploring our data is a crucial step that needs to be done before attempting any analysis. In this section, we will perform some basic exploration procedures to help us understand the structure of our data.

###

### Basic data information - Part I

The first thing we will do is to simply visualize the structure of our data. The tree dataset contains information about the tree community in 1973 following the hemlock looper outbreak. Let us visualize the data:
```{r}
tree

nrow(tree)

```

As you can see, the tree dataset contains 8 variables (columns) and 1780 observations (this is what the 'nrow' command, that is the number of rows, shows). The sampling design goes as follows: 

- **Block** - the region where the trees were sampled
- **Compartment** - a section of the block
- **Plot** - 400 $m^2$ plots nested within a compartment, which is the sampling unit
- **Cell** - multiple random cells were used per plot to sample the trees
- **Species** - name of the tree species that was identified
- **Species_abbrev** - a short name for the tree species
- **Condition** - condition of the tree that was identified (Dead, Questionable, or Good)
- **Number** - count of each tree species sampled in a cell

###

If you run the code above in your own R console, you will realize that it will not show the table as we see it here. However, you have multiple options to visualize your data directly in your console. Here are some examples.

Looking at the first 6 lines:
```{r}
head(tree, 6)

```

Listing the column names:
```{r}
names(tree)

```

Investigate the variable types:
```{r}
str(tree)

```

### Basic data information - Part II

We know that the column "Species" contains information about the tree species that were identified. It would be good to know which species were identified on Anticosti in 1973. To do so, we can simply run the following code:
```{r}
levels(as.factor(tree$Species))

```

As you can see, there are 7 tree species. We can do the same thing to get a glimpse of the other categorical variables:
```{r}
levels(as.factor(tree$Block))

levels(as.factor(tree$Compartment))

levels(as.factor(tree$Condition))

```

### Minor adjustments to the data

In the previous code output, we saw that there was a species called "Larch". We will change the name of the "Larch" species for "American larch", since we know that only this species can be found on Anticosti Island. We do so by running the following code:
```{r}
tree$Species <- gsub("Larch", "American larch", tree$Species)

```

We also know that the column called "Number" indicates the number of trees of a given species that were counted in a cell. However, it is usually better to have individual counts, and not a summary of total counts per sampling unit. We will thus manipulate the "Number" column to extract the counts of each individual species as follows:
```{r}
tree <- tree[rep(seq(.N), Number)]
tree[, Number := 1]

```

### Visualizing our tidy dataset

As you will see, the "Number" variable is now always equal to 1 since we wanted all individual observations. Of course, the dataset now has more observations, as shown by the nrow command:
```{r}
tree

nrow(tree)

```

We now have a good understanding of our data and are thus ready to move on and analyse it!

---------------------------------------------------------------------------------------

## 1. Describe the tree community

Our first objective is to characterize the tree community by gaining an overview of the tree species that were identified during the outbreak. To do so, we are going to plot the distribution of each tree species using a boxplot. This will provide us information on the abundances of each species, and then their health status, across the island.

###

### Preparing the boxplots

We will first need to further manipulate our data to create our boxplot. Here, we will create a simple table from our tree dataset. In this table, we will count the number of individuals per species that were sampled in each plot. Recall that each block represents a region of the island, compartments are smaller sections within the blocks, and plots are further nested within compartments.

To simplify the data's structure, we will calculate a unique count ('count_ind') of tree species that were found in each plot sampled in a compartment of a given block. Here is the procedure:
```{r}
# a. Compute the count of individuals per species in each plot
tree[, count_ind := sum(Number),
     by = .(Species, Plot, Compartment, Block)]

# b. Keep only unique rows
# We filter out the "Condition" and "Cell" fields to ensure that rows are unique
boxplot_tab <- unique(tree[, !c("Condition","Cell")])

```

###

We will then prepare a custom theme so that our boxplot looks nice. You can customize this theme as you wish.
```{r}
# We then prepare a custom theme to have a nice plot
custom_theme <- theme(# axis values size
                      axis.text.x = element_text(face = "plain", 
                                                 size = 12,
                                                 color = "black"),
                      axis.text.y = element_text(face = "plain", 
                                                 size = 12,
                                                 color = "black"),
                      # axis ticks lenght
                      axis.ticks.length = unit(.15, "cm"),
                      # axis ticks width
                      axis.ticks = element_line(size = 0.90, 
                                                color = "black"),
                      # axis titles size
                      axis.title = element_text(size = 15, 
                                                face = "plain"),
                      plot.title = element_text(size = 17, 
                                           face = "plain"),
                      axis.line = element_line(size = 0.95),
                      #legend.position = "none",
                      panel.grid = element_blank(),
                      panel.background = element_blank())

```

OK. We are now ready to go!

### Let us plot our data

Now, we can create and visualize our boxplot:
```{r, fig.width = 8, fig.height = 8}
ggplot(boxplot_tab,
       aes(x = Species,
           y = count_ind)) +
  geom_boxplot(fill = "light green",
               color = "black",
               outlier.shape = NA) +
  geom_jitter(shape = 16,
              alpha = 0.3,
              position = position_jitter(0.3)) +
  xlab("Tree species\n") +
  ylab("\nNumber of individual trees per plot") +
  scale_y_continuous(breaks = seq(0, 100, 20)) +
  custom_theme +
  coord_flip()

```

<br>

The boxplot shows the various tree species on the y-axis, and the x-axis represents the number of individual trees counted in each plot. Each grey circle in the figure represents an individual observation, and gives us a view of the distribution of counts for each species. Recall that for a boxplot, the line in the center of the box represents the median number of individuals corresponding to a given tree species.

From this boxplot, we see that seven different tree species were identified: 

 - White birch - *Betula papyrifera*
 - White spruce - *Picea glauca*
 - Black spruce - *Picea mariana*
 - American larch - *Larix laricina*
 - Aspen - *Populus* spp.
 - Pine - *Pinus* spp.
 - Balsam fir - *Abies balsamea*

<br> 

```{r, echo = FALSE, out.width = "80%", fig.align = "center", fig.cap = "Tree species that were sampled on Anticosti Island. Photography credits are as follows: white birch - Bryant Olsen, white spruce - dmcdevit, black spruce - Treetime.ca, larch - Walter Siegmund, aspen - Diana Robinson, pine - Walter Siegmund, and balsam fir - R. A. Nonenmacher."}
knitr::include_graphics("images/Tree_Anticosti.png")
```

<br>

### Let us test our knowledge!

From looking at the boxplot: 

```{r checkbox-a, echo = FALSE}
question("What are the two **MOST** abundant tree species?",
  answer("White birch - *Betula papyrifera*", message = "**Hint**: we are looking for the species with the **largest** median value of individuals identified"),
  answer("White spruce  - *Picea glauca*", message = "**Hint**: we are looking for the species with the **largest** median value of individuals identified"),
  answer("Black spruce - *Picea mariana*", correct = TRUE, message = "Black spruce is the tree species with the **second largest** median value of individuals identified."),
  answer("American larch - *Larix laricina*", message = "**Hint**: we are looking for the species with the **largest** median value of individuals identified"),
  answer("Aspen - *Populus* spp.", message = "**Hint**: we are looking for the species with the **largest** median value of individuals identified"),
  answer("Pine - *Pinus* spp.", message = "**Hint**: we are looking for the species with the **largest** median value of individuals identified"),
  answer("Balsam fir - *Abies balsamea*", correct = TRUE, message = " Balsam fir is the tree species with the **largest** median value of individuals identified"),
  allow_retry = TRUE
)
```

```{r checkbox-b, echo = FALSE}
question("What tree species is the **LEAST** abundant?",
  answer("White birch - *Betula papyrifera*", message = "**Hint**: we are looking for the species with the **smallest** median value of individuals identified."),
  answer("White spruce - *Picea glauca*",  message = "**Hint**: we are looking for the species with the **smallest** median value of individuals identified."),
  answer("Black spruce - *Picea mariana*",  message = "**Hint**: we are looking for the species with the **smallest** median value of individuals identified."),
  answer("American larch - *Larix laricina*", correct = TRUE, message = "American larch is the tree species with the **smallest** median value of individuals identified."),
  answer("Aspen - *Populus* spp.", message = "**Hint**: you are close! Is there a tree species with a **smaller** median value of individuals identified?"),
  answer("Pine - *Pinus* spp.", message = "**Hint**: you are close! Is there a tree species with a **smaller** median value of individuals identified?"),
  answer("Balsam fir - *Abies balsamea*", message = "**Hint**: we are looking for the species with the **smallest** median value of individuals identified."),
  allow_retry = TRUE
)
```

---------------------------------------------------------------------------------------

## 2. Estimate tree damage

Knowing the relative abundance of the island's tree species, we now need to assess the damage that was done by the hemlock looper outbreak. The scientists who sampled the individual trees assigned a damage state to each one of them. They assigned one of the three following states: "Good", "Questionable" or "Dead." Hence, our second objective is to determine, for each species, the proportion of trees that were denoted as dead by the scientists. This should give us a general overview of the damage across the island.

###

### Preparing the plot

To investigate the differences in damage among the tree species, we first need to calculate the proportion of each observed damage states per tree species. Similar to what we did before, we need to create a table from the tree dataset to plot our observations. Here, we count the number of damage states per tree species and then divide it by the total number of observed states:
```{r}
tree_damage <- tree %>%
  group_by(Species, Condition) %>%
  summarise(n = n()) %>%
  mutate(freq = n / sum(n))
```

### Let us plot our data

We can now plot the proportion of damage for each tree species with the following commands:
```{r, fig.width = 9, fig.height = 6}
ggplot(tree_damage,
       aes(y = freq,
           x = Species,
           fill = Condition)) + 
  geom_bar(position = "stack",
           stat = "identity",
           color = "black") +
  scale_fill_manual(values = c("plum", "light green", "khaki1")) +
  ggtitle("Relative damage for each tree species") +
  xlab("Tree species\n") +
  ylab ("\nProportion of damage") +
  custom_theme +
  coord_flip()
```

### Let us test our knowledge!

From looking at this plot:

```{r checkbox-c, echo = FALSE}
question("What tree species was **MOST** affected by the hemlock looper? Select all that apply.",
  answer("White birch - *Betula papyrifera*", message = "**Hint**: we are looking for the species with the **most** individuals denoted as 'Dead' (purple bar)."),
  answer("White spruce  - *Picea glauca*",  message = "**Hint**: you are close! Is there a tree species with **more** individuals denoted as 'Dead' (purple bar)?"),
  answer("Black spruce - *Picea mariana*", message = "**Hint**: we are looking for the species with the **most** individuals denoted as 'Dead' (purple bar)."),
  answer("American larch - *Larix laricina*.", message = "**Hint**: we are looking for the species with the **most** individuals denoted as 'Dead' (purple bar)."),
  answer("Aspen - *Populus* spp.", message = "**Hint**: we are looking for the species with the **most** individuals denoted as 'Dead' (purple bar)."),
  answer("Pine - *Pinus* spp.", message = "**Hint**: we are looking for the species with the **most** individuals denoted as 'Dead' (purple bar)."),
  answer("Balsam fir - *Abies balsamea*", correct = TRUE,  message = "Balsam fir is the species with the **most** individuals denoted as 'Dead' (purple bar)."),
  allow_retry = TRUE
)
```

```{r checkbox-d, echo = FALSE}
question("What three tree species were **LEAST** affected by the hemlock looper? Select all that apply.",
  answer("White birch - *Betula papyrifera*", message = "**Hint**: we are looking for the species with the **most** individuals denoted as 'Good' (green bar)."),
  answer("White spruce - *Picea glauca*", message = "**Hint**: we are looking for the species with the **most** individuals denoted as 'Good' (green bar)."),
  answer("Black spruce - *Picea mariana*", message = "**Hint**: we are looking for the species with the **most** individuals denoted as 'Good' (green bar)."),
  answer("American larch - *Larix laricina*", correct = TRUE),
  answer("Aspen - *Populus* spp.", correct = TRUE),
  answer("Pine - *Pinus* spp.", correct = TRUE, message = "American larch, aspen, and pine are the three species with the **most** individuals denoted as 'Good' (green bar)."),
  answer("Balsam fir - *Abies balsamea*", message = "**Hint**: we are looking for the species with the **most** individuals denoted as 'Good' (green bar)."),
  allow_retry = TRUE
)
```

### New questions emerge

The two previous plots beg the following question: were hemlock loopers attacking balsam firs because they were more abundant on Anticosti Island, or because this is their preferred prey? In other words, is the hemlock looper a **generalist** or a **specialist** insect pest species?

Let us break this idea down: 

 - A species is a **generalist** if it can live in a variety of environments and eat a variety of foods, meaning it is quite flexible in terms of its diet and habitat requirements.
 - A species is a **specialist** if it has a limited diet, and stricter habitat requirements, meaning it cannot live anywhere and cannot eat anything.

Two great examples are pigeons and koalas -- pigeons live in a diversity of urban environments and are omnivores (eat plant and animal matter), while koalas only live on and eat eucalyptus.

```{r, echo = FALSE, out.width = "70%", fig.align = "center", fig.cap = "Example of a specialist and generalist species. Photography credits: pigeon - Andrew Dunn and koala - Kévin Charpentier."}
knitr::include_graphics("images/specialist_generalist.png")
```

<br>

With this in mind, let us continue our investigation to gain some further insights.

---------------------------------------------------------------------------------------

## 3. Evaluate the hemlock looper's preferences

We have observed that balsam firs and black spruces were the most abundant tree species, but that their relative damage was largely different. This suggests that the hemlock looper may preferentially attack balsam firs, but we need to consider the relative abundance of each tree species to confirm this hypothesis. Let us convey this idea with a comic.

Imagine you are a hemlock looper about to lay its eggs. Wouldn't it be most convenient to lay them on the first tree you find? In this case, the more abundant a tree is, the more likely it is to be predated upon. 

Alternatively, perhaps hemlock loopers prefer a particular tree species because it has more tender leaves. In this case, even if this species was more rare in the forest, we would notice it has more hemlock looper damage than we would expect based on its relative abundance.

```{r, echo = FALSE, out.width = "70%", fig.align = "center", fig.cap = "Comic on the role of relative abundance and pest prevalence, by Victoria Marie Glynn."}
knitr::include_graphics("images/moth_pref.png")
```

###

### How can we estimate specialization?

The comic we just saw suggests that we need to consider the **relative abundance** (%) of a given tree species, our x-axis or independent variable, as it relates to the **relative prevalence** (%) of trees that were denoted as **"dead,"** our y-axis or dependent variable, which is a proxy for predation pressure. With this in mind, we can create the following schematic to predict **three possible scenarios**.

These three scenarios are our **hypotheses**, as these are possible answers to our overall question - did the hemlock looper preferentially attack certain tree species?

For each hypothesis, we have a corresponding **prediction**, the outcome we would expect to see if our hypothesis is supported. 

Making hypotheses and predictions before diving into data analysis is very useful, as it allows us to foresee and think through the dynamics represented in our dataset, improving our ability to interpret our results. 

```{r, echo = FALSE, out.width = "80%", fig.align = "center", fig.cap = "Three possible scenarios regarding the hemlock loopers' predation behavior."}
knitr::include_graphics("images/rel_abund.jpg")
```

<br> 

**Null hypothesis** - The hemlock looper has no preference on what tree it predates upon -- it is a **generalist** pest species:  

- **Prediction** - We would see this on our graph as a **one-to-one relationship** (diagonal black line), where a tree species' abundance in the forest is directly proportional to the number of trees from that species denoted as "dead." This means that the trees with the highest abundance will also be the most attacked.

**Hypothesis 1** - The hemlock looper prefers to predate upon some species versus others -- it is a **specialist** pest species:  

- **Prediction** - We would see this on our graph if a tree species' points lie **above the one-to-one line** (orange triangle). This means that the hemlock looper attacks more trees of a given species (tree denoted as "dead") even if the relative abundance of this species is low. This reflects that the looper is actively seeking out these three species. 

**Hypothesis 2** - The hemlock looper avoids some species, and thus these are less predated upon -- it is a **specialist** pest species:  

- **Prediction** - We would see this on our graph if a species' points lie **below the one-to-one line** (blue triangle). This means that less individuals of a given tree species are attacked by the hemlock looper, even if their abundance relative to other species is high. This reflects that the looper is avoiding these tree species.

<br>

### Testing our hypothesis

Let us plot our actual data and see where the results lie, in relationship to our guiding schematic above.

We will start by filtering out the "Questionable" tree status, as it is unclear if these trees will die as a result of the hemlock looper outbreak. Then, we will calculate the total abundance of tree species by plot, which were denoted as either "Dead" or "Alive." With this, like we did before, we will be able to calculate the abundance of a given species relative to the abundance of all species within a plot.
```{r}

# Filter out "Questionable" individuals
tree_filter <- tree[Condition != "Questionable",
                    .(Block, Compartment, Plot, Species, Condition, Number)]

# Calculate the number of individuals of each species for each plot
tree_filter[, ind_sp_plot := sum(Number),
            by = .(Species, Plot, Compartment, Block)]

# Calculate the total abundance of individuals, irrespective of the species, in each plot
tree_filter[, total_id_plot := sum(unique(ind_sp_plot)),
            by = .(Plot, Compartment, Block)]

# Calculate the relative abundance of each species in each plot
tree_filter[, rel_abund_plot := ind_sp_plot / total_id_plot]

```

###

We then evaluate the count of "Dead" trees per species, relative to all individuals denoted as "Dead," across all plots:
```{r}

# Calculate the total count of "Dead" individuals by plot
tree_filter[Condition == "Dead",
            total_dead := length(Condition),
            by = .(Plot, Compartment, Block)]

# Calculate the number of "Dead" individuals per each species, for each plot
tree_filter[Condition == "Dead",
            dead_sp_plot := length(Condition),
            by = .(Species, Plot, Compartment, Block)]

# Calculate each species' "Dead" status relative to other species
tree_filter[Condition == "Dead",
            prop_dead_plot := dead_sp_plot / total_dead,
            by = .(Species, Plot, Compartment, Block)]

# Keep unique values with only "Dead" rows and use this table for plotting
tree_filter <- unique(tree_filter[Condition == "Dead",])

```

###

We finish by plotting the relationship between tree species' relative abundance and being denoted as "Dead":
```{r, fig.width = 8.5, fig.height = 6}

ggplot(tree_filter,
       aes(x = rel_abund_plot,
           y = prop_dead_plot,
           colour = Species)) +
  geom_abline(intercept = 0,
              slope = 1,
              size = 0.8,
              linetype = "dashed") +
  geom_point(size = 4,
             shape = 21,
             aes(fill = Species)) +
  scale_colour_manual(values = c("black","black", "black", "black")) +
  scale_fill_manual(values = c("darkgreen", "chartreuse4", "lemonchiffon1", "lightgreen")) +
  ylab("Relative abundance of dead tree species\n") +
  xlab("\nRelative abundance of focal tree species") +
  scale_y_continuous(breaks = seq(0, 1, .25),
                     limits = c(0,1)) +
  scale_x_continuous(breaks = seq(0, 1, .25),
                     limits = c(0,1)) +
  custom_theme

```

### Let us test our knowledge!

From the graph and based on our predictions above, we can now answer the question:

```{r letterx-d, echo = FALSE}
question("Do hemlock loopers preferentially attack a given tree species?",
  answer("**Yes**, hemlock loopers preferentially attack **balsam fir trees** because there are proportionally more dead trees of this species relative to their overall abundance in the forest", correct = TRUE, message = "We see that all the data points for balsam fir (darkest green) are above the one-to-one line (dotted, black)."),
  answer("**Yes**, hemlock loopers preferentially attack **black spruce trees** because there are proportionally less dead trees of this species relative to their overall abundance in the forest",  message = "**Hint**: recall that if data points are **below** the one-to-one line, this means that although there are many trees of this species, this does not correlate to more trees being denoted 'dead.'"),
  answer("**No**, the relative abundance of dead trees for each species is directly proportional to their overall abundance in the forest", message = "**Hint**: where are most data points located, relative to the one-to-one line (dotted, black)? What does this mean in terms of pest preference?"),
  answer("I am not sure, I would need more data", message = "**Hint**: you do have enough information to answer this question! Recall that the position of the data points relative to the one-to-one line (dotted, black) can provide insights on pest preference."),
  allow_retry = TRUE
)
```

---------------------------------------------------------------------------------------

## 4. Management recomendations

### What do our findings imply in terms of hemlock looper management, within and outside Anticosti Island?

This dataset represents one of the many hemlock looper outbreaks that Anticosti Island, and Québec as a whole, has experienced. However, similar outbreaks have been seen across Canada, such as in Vancouver. Please see the three videos below regarding how different provinces are managing the hemlock looper. While watching the videos consider the following questions:

1. What factors naturally control the hemlock looper's population? 
2. What environmental factor(s) may be exacerbating a hemlock looper outbreak in a forest? 
3. What management intervention strategies are typically implemented? 

<br>

 
#### **Hemlock loopers killing Stanley Park trees in Vancouver, British Columbia**
![](https://www.youtube.com/watch?v=lnTNT_HhnL8)

<br>

#### **Hemlock looper's natural cycle in Metro Vancouver, British Columbia**
![](https://www.youtube.com/watch?v=lPWERt8coks)

<br>

#### **Extent of damage due to the hemlock looper in Metro Vancouver, British Columbia**
![](https://www.youtube.com/watch?v=ZETdXXo1Q0k)

<br>

---------------------------------------------------------------------------------------

### **Using the past to look forward** 

<br>

#### After watching these videos and reflecting on the insights from the Anticosti dataset (**Hint**: think about relative tree mortality, the hemlock looper's life cycle), provide one management strategy that Metro Vancouver could implement in the coming year if they have another hemlock looper outbreak. Submit this to your instructor as a PDF document (250 words max). 

---------------------------------------------------------------------------------------

<br>

### **How do we manage a moth that is native to Canada?** 

As the videos highlighting the outbreak in British Columbia present, **there is no one "right answer" to pest management**, as it should be an integrative, collaborative, and ever-evolving endeavor. However, having data to drive these decisions is a powerful tool: 

- Although our data indicates that on Anticosti Island, the hemlock looper had a preference for balsam fir in 1973, this is not its only or main host. **By directing management initiatives towards a single tree species, this may cause other equally-liked trees to be even more strongly attacked** -- this is a delicate balance to strike. Likewise, this dataset is from the 20th century -- would you foresee consumer-resource dynamics in Anticosti Island to have changed since?

- Adding a biological agent, like the fungi *Entomophthora* or bacteria *Bacillus thuringiensis kurstaki* (Btk) to control hemlock looper seems like a sensible option. Perhaps you think this is better than spraying a chemical insecticide. But **biological agents** are as controversial, as they **can often have unintended consequences**, impacting species you did not wish to target. See this wonderful [paper](https://www.researchgate.net/publication/225059823_The_natives_are_restless_but_not_often_and_mostly_when_disturbed) that delves into this topic further. 

- **Prevention is often be more effective than intervention.** Understanding the hemlock looper's life history is a critical component here -- we know the larvae prefer certain species and more mature tree stands. We can promote forests of a certain age and species composition, and evenly spread out tree stands, to reduce the probability of a hemlock looper outbreak in the future.
 
- With all management initiatives, it is important to **consult the local community and have them integrally involved in the process**, such as the [Innu community on the North Shore](https://ici.radio-canada.ca/nouvelle/1011203/unesco-cinq-communautes-innues-solidaires-danticosti). Asking them what the want the forest to look like and what they need, and not making these assumptions, can help ensure that pest management initiatives are ethical, sustainable, and as such, a success. 

- Hemlock looper outbreaks are cyclical in nature, and may in and of themselves be necessary for forest health, taking the regenerative role of fire disturbance in many places. Although epidemic outbreaks can be quite devastating, **some tree mortality may actually be beneficial for a tree stand's long-term health.** 

---------------------------------------------------------------------------------------


## Main takeaways

As our Anticosti Island tree dataset underscores, historical data is a powerful tool to help us best contextualize current management concerns, and assist us in making data-driven decisions.

After our tutorial, you have: 

- **Interpreted community ecology plots,** *to understand the tree community present on Anticosti Island in 1973, and how different species were impacted by the hemlock looper outbreak.*

- **Differentiated between a generalist and specialist pest species, using community ecology plots,** *by connecting how the relative abundance of a given tree species is linked to the species being found dead.*

- **Made data-driven management recommendations,** *considering not only the data presented in the tutorial, but also looking further into the biology of the hemlock looper in Vancouver, British Columbia, what already established strategies exist, and thinking critically about the link between society and the environment.* 

<br>

Consumer-resource interactions are complex but bringing past data to the present may help us devise sound and sustainable management practices.

---------------------------------------------------------------------------------------

### Further reading

- [Hemlock Looper, Overview of the last 15 years - Presentation by Christian Hébert during the Pest Forum – 2 December, 2008](http://www.glfc.forestry.ca/VLF/ForumPresentations/heberthemlocklooper_08e.pdf)

- [Overview of hemlock looper outbreaks in Western North America, natural controls and management](https://www.fs.usda.gov/foresthealth/docs/fidls/FIDL-186-WesternHemlockLooper.pdf)

- [Overview of the hemlock looper across North America, its life history, and sampling and management considerations](https://www.fs.usda.gov/Internet/FSE_DOCUMENTS/stelprdb5191788.pdf)

- [The impact of hemlock looper (*Lambdina fiscellaria fiscellaria* (Guen.)) on balsam fir and spruce in New Brunswick, Canada](https://www.sciencedirect.com/science/article/abs/pii/S0378112798005271?casa_token=pZW2ZnLwB0YAAAAA:bJHXx-f-cIU7UOPzxfe9Swj5OD9Gfm6bs3AM0ZK7IekzDOUzOdmayh9z62VAO6gV3Sjy8VVcMw#FIG2)

- [Early succession of bark and wood boring beetles during an outbreak of the hemlock looper (*Lambdina fiscellaria* (Guenée)) (Lepidoptera: Geometridae) in boreal balsam fir forest](https://www.researchgate.net/publication/334302125_Early_responses_of_bark_and_wood_boring_beetles_to_an_outbreak_of_the_hemlock_looper_Lambdina_fiscellaria_Guenee_Lepidoptera_Geometridae_in_a_boreal_balsam_fir_forest_of_North_America)

- [Early responses of bark and wood boring beetles to an outbreak of the hemlock looper *Lambdina fiscellaria* (Guenée) (Lepidoptera: Geometridae) in a boreal balsam fir forest of North America](https://resjournals.onlinelibrary.wiley.com/doi/abs/10.1111/afe.12347)

- [Extreme cold weather causes the collapse of a population of *Lambdina fiscellaria* (Lepidoptera: Geometridae) in the Laurentian Mountains of Québec, Canada](https://www.cambridge.org/core/journals/canadian-entomologist/article/abs/extreme-cold-weather-causes-the-collapse-of-a-population-of-lambdina-fiscellaria-lepidoptera-geometridae-in-the-laurentian-mountains-of-quebec-canada/4D36CE7C818EF7D75D8E5C7B7F75DA0F)

- [Capability of ERTS-1 imagery for mapping forest cover types of Anticosti Island](https://pubs.cif-ifc.org/doi/pdf/10.5558/tfc50233-6)


---------------------------------------------------------------------------------------
