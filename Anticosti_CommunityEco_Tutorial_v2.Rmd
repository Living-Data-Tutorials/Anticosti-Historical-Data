---
title: "After the storm: Impacts of a hemlock looper (*Lambdina fiscellaria*) outbreak on tree species in Anticosti Island, 1973"
author: "Living Data Project - Victoria Marie Glynn (McGill) and Maxime Fraser Franco (UQAM)"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  #github_document: default
  html_document:
    toc: true
    toc_float: true
    number_sections: true
---

**Using real data from a devastating pest outbreak in Québec, we will begin to explore how biological invasions impact ecological communities.**

--------------------------------------------------------------------------------------------------------------------------------------------

Start by giving some context/background on Anticosti to emphazise why it is important...

When you think of predator-prey interactions, what comes to mind? Perhaps it is the emblematic hare and lynx example from the [Hudson's Bay Company pelt-trading dataset](https://jckantor.github.io/CBE30338/02.05-Hare-and-Lynx-Population-Dynamics.html), or footage from nature documentaries that show lions hunting zebras. But predator-prey interactions are often less conspicuous, and still strongly impact ecological communities. A great example are insect pests and their plant prey. In this tutorial, we are going to explore an instance of this interaction on Anticosti Island, Québec, between the hemlooper looper (*Lambdina fiscellaria*) and the trees it predates upon. 

------------------------------------------------------------------------------

<center>

![Map of Anticosti Island, Québec](anticosti_loc.png) ![Hemlock looper larvae on a tree branch](hemlock_looper_larva.jpg)

</center>


```{r setup, include = FALSE} 
knitr::opts_chunk$set(echo = TRUE)
```

# What happened? 

[insert before and after pictures]

[talk about degree of damage]

[link follow-up papers on the area]

Their sampling approach was as follows: 

- The forest was divided into various blocks
- Each block was further subdivided into compartments
- The compartments are composed of parcels, each 400 m^2

<center>
![Sampling design for forest inventory](sampling_design.png)
</center>


# Learning objectives 

**Given the hemlock looper was such an aggressive pest, our task today is to determine:**

 1. **What is the tree species composition of the Anticosti Island?**
 2. **Does the hemlock looper preferentially attack some trees or instead multiple trees?**
 3. **Does the hemlock looper attack specific trees because they are more abundant?**
 
**Based on what you find, we will ask you to provide some management strategies, as the hemlock looper is still an issue in Québec's forests.**

------------------------------------------------------------------------------
<center>

# Setting up our R session

Let's start by loading some packages we will use for our analyses
```{r, message = FALSE, warning = FALSE}
library(data.table)
library(ggplot2)
library(viridis)
```

Then, we import the data in the current R session
```{r, message = FALSE, warning = FALSE}
# Tree condition data url paths
url_tree <- "https://open.canada.ca/data/en/dataset/9dda09b0-649f-4002-b207-7b204eb81cbb/resource/a1606235-95aa-4c81-a8db-19b852be288c"
csv_tree <- "download/anticosti_1973_trees.csv"

# Import the data and keep the data we need
tree <- fread(file.path(url_tree, csv_tree),
              select = c("Block", "Compartment", "Plot",
                         "Cell", "Species", "Species_abbrev",
                         "Condition", "Number"))

# Separate row number in instances to have all individual counts
tree <- tree[rep(seq(.N), Number)]
tree[, Number := 1]
```

# Describing Anticosti Island's tree community composition

## What is the distribution of the tree species across blocks?:

```{r, echo = FALSE, message = FALSE, warning = FALSE, include = FALSE}

# Prepare some plot customizations
cbPalette <- c("#999999", "#E69F00", "#56B4E9", "#009E73",
               "#F0E442", "#0072B2", "#D55E00", "#CC79A7")

# Diversity of trees per block

tree_bloc <- ggplot(tree, aes (y = Number, x = Block, fill = Species_abbrev)) + 
    geom_bar(position = "stack", stat = "identity")

tree_bloc

tree_bloc2 <- tree_bloc + scale_fill_manual(values=cbPalette) + 
    ggtitle("Tree species across blocks, during hemlock looper outbreak in 1973") +
    xlab("\nBlock") + 
    ylab ("Count of species\n") +
    scale_fill_discrete(name = "Tree species")
```

```{r, echo = FALSE, message = FALSE, warning = FALSE}
tree_bloc2
```

<br>

**From looking at this plot:** 

- 1. Which tree is the most abundant species across all our blocks? 

- 2. Which tree is the least abundant species across all our blocks? 

<br>

# How much were the different tree species damaged by the hemlock looper?

```{r, echo = FALSE, message = FALSE, warning = FALSE, include = FALSE}

# Differences in tree condition per plot

# Diversity of trees per compartment 

treecon <- ggplot(tree, aes (y = Number, x = Species_abbrev, fill = Condition)) + 
    geom_bar(position = "stack", stat = "identity")

treecon

treecon_2 <- treecon + scale_fill_manual(values=cbPalette) + 
    ggtitle("Tree condition across species, during hemlock looper outbreak in 1973") +
    xlab("\nSpecies") +
    ylab ("Count of species\n") +
    scale_fill_discrete(name = "Tree condition")

```

```{r, echo = FALSE, message = FALSE, warning = FALSE}
treecon_2
```

# Does the hemlock looper attack trees because they are abundant?

</center>


